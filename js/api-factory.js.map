{"version":3,"sources":["api-factory.es6"],"names":[],"mappings":"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","file":"api-factory.js","sourcesContent":["(function () {\n\t'use strict';\n\n\t/**\n\t * @ngdoc service\n\t * @name query.factory:Api\n\t *\n\t * @description\n\t *\n\t */\n\tangular\n\t\t.module('query')\n\t\t.factory('Api', Api);\n\n\tfunction Api($http, $sce, Data, State) {\n\t\tlet ApiBase = {};\n\t\tApiBase.someValue = 'Api';\n\t\tApiBase.someMethod = () => {\n\t\t\treturn 'Api';\n\t\t};\n\n\t\tApiBase.trustSrc = function (src) {\n\t\t\tconsole.log('trust src', src);\n\t\t\treturn $sce.trustAsResourceUrl(src);\n\t\t};\n\t\tApiBase.parseSheet = (sheetId) => {\n\t\t\tvar sheetJson = 'https://spreadsheets.google.com/feeds/cells/' + sheetId + '/1/public/values?alt=json-in-script&callback=doData';\n\t\t\t$http.get(sheetJson).then((success)=>{\n\t\t\t\tvar replace = success.data.replace('// API callback\\ndoData(', '');\n\t\t\t\tconsole.info(replace);\n\t\t\t\tvar slice = replace.replace(');', '');\n\t\t\t\tconsole.info(slice);\n\t\t\t\tState.sheetData = JSON.parse(slice);\n\n\t\t\t},(error)=>{\n\t\t\t\tconsole.log(error);\n\t\t\t})\n\t\t};\n\t\tApiBase.parseSheet('1cTKB4VTRk4-qdOtMkC12JMXdMIlgqTDwu8QruJg-ysc');\n\t\tApiBase.querify = () => {\n\t\t\tDate.prototype.getJulian = function () {\n\t\t\t\treturn Math.floor(this / 86400000 - this.getTimezoneOffset() / 1440 + 2440587.5);\n\t\t\t};\n\t\t\tvar cities = ['new york city'];\n\t\t\tvar venues = ['Webster Hall', 'PlayStation Theater', 'Gramercy Theatre'];\n\t\t\tvar bands = ['Daya', 'Tinashe', 'Nick Carter', 'Killswitch Engage'];\n\n\t\t\tvar today = new Date(); //set any date\n\t\t\tvar julian = today.getJulian();\n\t\t\t// var auth = '?key='+context.data.key+'&cx='+context.data.cx;\n\n\t\t\t//var location = 'new york city';\n\t\t\t//var band = 'Aventura & Romeo Santos';\n\t\t\t//var venue = 'United Palace Theatre';\n\t\t\tvar dateRange = 'daterange:' + (julian - 30) + '-' + julian;\n\n\t\t\tvar queries = {};\n\t\t\tfor (var x = 0; x < cities.length; x++) {\n\t\t\t\tfor (var y = 0; y < bands.length; y++) {\n\t\t\t\t\tqueries[bands[y]] = [];\n\t\t\t\t\tfor (var z = 0; z < venues.length; z++) {\n\t\t\t\t\t\t//var rawQuery = '&q=location:' + (locations[x] ? locations[x] : '') + ' ' + dateRange + ' %22' + (bands[z] ? bands[z] : '') + '%22 %22' + (venues[y] ? venues[y] : '') + '%22';\n\t\t\t\t\t\tvar rawQuery = 'location:\"' + (cities[x] ? cities[x] : '') + '\" ' + dateRange + ' \"' + (bands[y] ? bands[y] : '') + '\" \"' + (venues[z] ? venues[z] : '') + '\"';\n\t\t\t\t\t\tvar query = encodeURIComponent(rawQuery);\n\t\t\t\t\t\tconsole.log(bands[y] && venues[z] && cities[x] ? query : 'something missing');\n\t\t\t\t\t\tbands[y] !== undefined ? ApiBase.query(query, bands[y], venues[z], cities[x]) : null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet time = Date.now();\n\t\t\tData.fb.$loaded().then(()=> {\n\t\t\t\tData.fb[State.user.uid][time] = JSON.stringify(State.data);\n\t\t\t\tObject.keys(State.data).length > 0 ? Data.fb.$save() : null;\n\t\t\t\tconsole.info(Data.fb);\n\t\t\t});\n\t\t};\n\t\tApiBase.query = (query, band, venue, city) => {\n\n\t\t\tvar parsedResult = {};\n\t\t\tvar context = {};\n\t\t\tcontext.data = {};\n\n\t\t\t// context.data.key = 'AIzaSyAPQoU5zkFq3_sP3fB-v_V-mUhTspAU1bc';\n\t\t\t// context.data.key = 'AIzaSyAMQd1zbtPKZMTpH9Mqke2wnLlA1yBEoZU';\n\t\t\tcontext.data.key = 'AIzaSyD1c_QdWfmsIRw2HFo2LuJsQcMFGeu9BJw';\n\t\t\t// context.data.key = 'AIzaSyCoKhTHvXzcnYBdmwDijkVQ4BmoupX5qdc';\n\t\t\t// context.data.key = 'AIzaSyBL3VFlBRvdgmTeTQ_yr_E76RtNrtJn--k';\n\t\t\tcontext.data.cx = encodeURIComponent('009026615269609811859:gj09_ghhxea');\n\n\n\t\t\tvar baseUrl = 'https://www.googleapis.com/customsearch/v1';\n\t\t\t// var query = context.data.query;\n\t\t\tvar queryDebug = '&q=location:new%20york%20city daterange:2457403-2457433 %22Aventura%20%26%20Romeo%20Santos%22 %22bowery%20ballroom%22';\n\t\t\tvar auth = '?key=' + context.data.key + '&cx=' + context.data.cx;\n\t\t\tvar authQuery = auth + '&q=' + query;\n\t\t\tvar authQueryDebug = auth + queryDebug;\n\t\t\t// console.log(query);\n\t\t\tvar links = [];\n\t\t\tvar req = {\n\t\t\t\tmethod: 'GET',\n\t\t\t\turl: baseUrl + authQuery,\n\t\t\t\theaders: {\n\t\t\t\t\t'Accept': 'application/json',\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t}\n\t\t\t\t// data: { query: bands[z] && venues[y] && locations[x] ? query : 'something missing' }\n\t\t\t};\n\t\t\t$http(req).then(function (success) {\n\t\t\t\tconsole.log('$http success', success);\n\t\t\t\t(State.data[band] || success.data.queries.request['0'].count === 0) ? null : State.data[band] = [];\n\t\t\t\tsuccess.data.queries.request['0'].count !== 0 ? State.data[band].push({\n\t\t\t\t\tdata: success.data,\n\t\t\t\t\tvenue: venue,\n\t\t\t\t\tcity: city\n\t\t\t\t}) : null;\n\t\t\t}, function (error) {\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\t\t};\n\t\tApiBase.login = (user, pass) => {\n\t\t\tData.auth.$authWithPassword({\n\t\t\t\temail: user,\n\t\t\t\tpassword: pass\n\t\t\t}).then(function (auth) {\n\t\t\t\tconsole.log(\"Logged in as:\", auth.uid);\n\t\t\t\tState.user = auth;\n\t\t\t\tconsole.info('Data.fb[auth.uid]', Data.fb[auth.uid], 'ya!');\n\t\t\t\tData.history = Data.fb[auth.uid];\n\t\t\t}).catch(function (error) {\n\t\t\t\tconsole.error(\"Authentication failed:\", error);\n\t\t\t});\n\t\t};\n\t\tApiBase.logout = () => {\n\t\t\tData.auth.$unauth();\n\t\t\tState.user = null;\n\t\t};\n\t\tApiBase.register = (user, pass) => {\n\t\t\tData.auth.$createUser({\n\t\t\t\temail: user,\n\t\t\t\tpassword: pass\n\t\t\t}).then(function (userData) {\n\t\t\t\tconsole.log(\"User \" + userData.uid + \" created successfully!\");\n\t\t\t\tData.fb[userData.uid] = {created: Date.now()};\n\t\t\t\tData.fb.$save();\n\t\t\t\treturn Data.auth.$authWithPassword({\n\t\t\t\t\temail: user,\n\t\t\t\t\tpassword: pass\n\t\t\t\t});\n\t\t\t}).then(function (auth) {\n\t\t\t\tconsole.log(\"Logged in as:\", auth.uid);\n\t\t\t\tState.user = auth;\n\t\t\t}).catch(function (error) {\n\t\t\t\tconsole.error(\"Error: \", error);\n\t\t\t});\n\t\t};\n\t\treturn ApiBase;\n\t}\n}());\n"],"sourceRoot":"/source/"}