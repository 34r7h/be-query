{"version":3,"sources":["services/api-factory.es6"],"names":[],"mappings":";;AAAA,AAAC,CAAA,YAAY;AACZ,aAAY,CAAC;;;;;;;;;AASb,QAAO,CACL,MAAM,CAAC,OAAO,CAAC,CACf,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;;AAEtB,UAAS,GAAG,CAAC,KAAK,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,KAAK,EAAE;AAChD,MAAI,OAAO,GAAG,EAAE,CAAC;AACjB,SAAO,CAAC,QAAQ,GAAG,UAAU,GAAG,EAAE;;AAEjC,UAAO,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC;GACpC,CAAC;AACF,SAAO,CAAC,UAAU,GAAG,UAAC,OAAO,EAAE,cAAc,EAAK;AACjD,OAAI,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,YAAI;;;AAG1B,QAAI,SAAS,GAAG,EAAE,CAAC;AACnB,QAAI,SAAS,GAAG,EAAE,CAAC;AACnB,SAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAG,cAAc,EAAE,CAAC,EAAE,EAAC;AACpC,YAAO,CAAC,GAAG,CAAC,eAAe,EAAE,CAAC,GAAC,CAAC,CAAC,CAAC;AAClC,cAAS,CAAC,CAAC,CAAC,GAAG,8CAA8C,GAAG,OAAO,GAAG,GAAG,IAAE,CAAC,GAAC,CAAC,CAAA,AAAC,GAAC,mDAAmD,CAAC;AACxI,YAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;AAC1B,MAAC,UAAC,KAAK,EAAG;AACT,WAAK,CAAC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,UAAC,OAAO,EAAG;AAC3C,cAAO,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AAC1B,gBAAS,CAAC,KAAK,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,0BAA0B,EAAE,EAAE,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;AAC1F,WAAI,CAAC,EAAE,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,OAAO,GAAC,KAAK,CAAC,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC;OAC7D,EAAC,UAAC,KAAK,EAAG;AACV,cAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;OACnB,CAAC,CAAA;MACF,CAAA,CAAE,CAAC,CAAC,CAAC;KAEN;AACD,YAAQ,CAAC,YAAI;AAAC,SAAI,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC;KAAC,EAAC,KAAK,CAAC,CAAC;;IAEvC,CAAC,CAAC;GACH,CAAC;;AAEF,SAAO,CAAC,OAAO,GAAG,YAAM;AACvB,OAAI,CAAC,SAAS,CAAC,SAAS,GAAG,YAAY;AACtC,WAAO,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,QAAQ,GAAG,IAAI,CAAC,iBAAiB,EAAE,GAAG,IAAI,GAAG,SAAS,CAAC,CAAC;IACjF,CAAC;AACF,OAAI,MAAM,GAAG,CAAC,eAAe,CAAC,CAAC;AAC/B,OAAI,MAAM,GAAG,CAAC,cAAc,EAAE,qBAAqB,EAAE,kBAAkB,CAAC,CAAC;AACzE,OAAI,KAAK,GAAG,CAAC,MAAM,EAAE,SAAS,EAAE,aAAa,EAAE,mBAAmB,CAAC,CAAC;;AAEpE,OAAI,KAAK,GAAG,IAAI,IAAI,EAAE,CAAC;AACvB,OAAI,MAAM,GAAG,KAAK,CAAC,SAAS,EAAE,CAAC;AAC/B,OAAI,SAAS,GAAG,YAAY,IAAI,MAAM,GAAG,EAAE,CAAA,AAAC,GAAG,GAAG,GAAG,MAAM,CAAC;AAC5D,OAAI,OAAO,GAAG,EAAE,CAAC;AACjB,QAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACvC,SAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACtC,YAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;AACvB,UAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;;AAEvC,UAAI,QAAQ,GAAG,YAAY,IAAI,MAAM,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAA,AAAC,GAAG,IAAI,GAAG,SAAS,GAAG,IAAI,IAAI,KAAK,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,EAAE,CAAA,AAAC,GAAG,KAAK,IAAI,MAAM,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAA,AAAC,GAAG,GAAG,CAAC;AAC/J,UAAI,KAAK,GAAG,kBAAkB,CAAC,QAAQ,CAAC,CAAC;;AAEzC,WAAK,CAAC,CAAC,CAAC,KAAK,SAAS,GAAG,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;MACrF;KACD;IACD;AACD,OAAI,IAAI,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;AACtB,OAAI,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,YAAK;AAC3B,KAAC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,GAAG,EAAE,GAAG,IAAI,CAAC;AAC/E,QAAI,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;AACnE,UAAM,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC,KAAK,EAAE,GAAG,IAAI,CAAC;IAC5D,CAAC,CAAC;GACH,CAAC;AACF,SAAO,CAAC,KAAK,GAAG,UAAC,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAK;;AAE7C,OAAI,OAAO,GAAG,EAAC,IAAI,EAAC,EAAE,EAAC,CAAC;;;AAGxB,UAAO,CAAC,IAAI,CAAC,GAAG,GAAG,yCAAyC,CAAC;;;AAG7D,UAAO,CAAC,IAAI,CAAC,EAAE,GAAG,kBAAkB,CAAC,mCAAmC,CAAC,CAAC;;AAE1E,OAAI,OAAO,GAAG,4CAA4C,CAAC;AAC3D,OAAI,IAAI,GAAG,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,GAAG,GAAG,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC;AACjE,OAAI,SAAS,GAAG,IAAI,GAAG,KAAK,GAAG,KAAK,CAAC;AACrC,OAAI,GAAG,GAAG;AACT,UAAM,EAAE,KAAK;AACb,OAAG,EAAE,OAAO,GAAG,SAAS;AACxB,WAAO,EAAE;AACR,aAAQ,EAAE,kBAAkB;AAC5B,mBAAc,EAAE,kBAAkB;KAClC;;IAED,CAAC;AACF,QAAK,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,UAAU,OAAO,EAAE;AAClC,AAAC,SAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,KAAK,KAAK,CAAC,GAAI,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;AACnG,WAAO,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC;AACrE,SAAI,EAAE,OAAO,CAAC,IAAI;AAClB,UAAK,EAAE,KAAK;AACZ,SAAI,EAAE,IAAI;KACV,CAAC,GAAG,IAAI,CAAC;IACV,EAAE,UAAU,KAAK,EAAE;AACnB,WAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IACrB,CAAC,CAAC;GACH,CAAC;AACF,SAAO,CAAC,KAAK,GAAG,UAAC,IAAI,EAAE,IAAI,EAAK;AAC/B,UAAO,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC;AAC9B,OAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC;AAC3B,SAAK,EAAE,IAAI;AACX,YAAQ,EAAE,IAAI;IACd,CAAC,CAAC,IAAI,CAAC,UAAU,IAAI,EAAE;AACvB,WAAO,CAAC,GAAG,CAAC,eAAe,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;AACvC,QAAI,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,YAAI;AAAC,MAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,EAAC,OAAO,EAAE,IAAI,CAAC,GAAG,EAAE,EAAC,EAAE,IAAI,CAAC,EAAE,CAAC,KAAK,EAAE,CAAA,GAAI,IAAI,CAAA;KAAC,CAAC,CAAC;AACvH,SAAK,CAAC,IAAI,GAAG,IAAI,CAAC;AAClB,QAAI,CAAC,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACjC,CAAC,SAAM,CAAC,UAAU,KAAK,EAAE;AACzB,WAAO,CAAC,KAAK,CAAC,wBAAwB,EAAE,KAAK,CAAC,CAAC;IAC/C,CAAC,CAAC;GACH,CAAC;AACF,SAAO,CAAC,MAAM,GAAG,YAAM;AACtB,OAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;AACpB,QAAK,CAAC,IAAI,GAAG,IAAI,CAAC;GAClB,CAAC;AACF,SAAO,CAAC,QAAQ,GAAG,UAAC,IAAI,EAAE,IAAI,EAAK;AAClC,OAAI,CAAC,IAAI,CAAC,WAAW,CAAC;AACrB,SAAK,EAAE,IAAI;AACX,YAAQ,EAAE,IAAI;IACd,CAAC,CAAC,IAAI,CAAC,UAAU,QAAQ,EAAE;AAC3B,WAAO,CAAC,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,GAAG,GAAG,wBAAwB,CAAC,CAAC;AAChE,QAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,EAAC,OAAO,EAAE,IAAI,CAAC,GAAG,EAAE,EAAC,CAAC;AAC9C,QAAI,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC;AAChB,WAAO,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC;AAClC,UAAK,EAAE,IAAI;AACX,aAAQ,EAAE,IAAI;KACd,CAAC,CAAC;IACH,CAAC,CAAC,IAAI,CAAC,UAAU,IAAI,EAAE;AACvB,WAAO,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;AACxC,SAAK,CAAC,IAAI,GAAG,IAAI,CAAC;IAClB,CAAC,SAAM,CAAC,UAAU,KAAK,EAAE;AACzB,WAAO,CAAC,KAAK,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;IAChC,CAAC,CAAC;GACH,CAAC;AACF,SAAO,OAAO,CAAC;EACf;CACD,CAAA,EAAE,CAAE","file":"services/api-factory.js","sourcesContent":["(function () {\n\t'use strict';\n\n\t/**\n\t * @ngdoc service\n\t * @name query.factory:Api\n\t *\n\t * @description\n\t *\n\t */\n\tangular\n\t\t.module('query')\n\t\t.factory('Api', Api);\n\n\tfunction Api($http, $sce, $timeout, Data, State) {\n\t\tlet ApiBase = {};\n\t\tApiBase.trustSrc = function (src) {\n\t\t\t// console.log('trust src', src);\n\t\t\treturn $sce.trustAsResourceUrl(src);\n\t\t};\n\t\tApiBase.parseSheet = (sheetId, worksheetCount) => {\n\t\t\tData.fb.$loaded().then(()=>{\n\t\t\t\t//!Data.fb.sheetData ? Data.fb.sheetData = {} : null;\n\t\t\t\t// Data.fb.sheetData[sheetId] = {};\n\t\t\t\tvar sheetFeed = [];\n\t\t\t\tvar sheetJson = [];\n\t\t\t\tfor(var x=0; x < worksheetCount; x++){\n\t\t\t\t\tconsole.log('Parsing sheet', x+1);\n\t\t\t\t\tsheetJson[x] = 'https://spreadsheets.google.com/feeds/cells/' + sheetId + '/'+(x+1)+'/public/values?alt=json-in-script&callback=doData';\n\t\t\t\t\tconsole.log(sheetJson[x]);\n\t\t\t\t\t((count)=>{\n\t\t\t\t\t\t$http.get(sheetJson[count]).then((success)=>{\n\t\t\t\t\t\t\tconsole.log(success.data);\n\t\t\t\t\t\t\tsheetFeed[count] = success.data.replace('// API callback\\ndoData(', '').replace(');', '');\n\t\t\t\t\t\t\tData.fb.sheetData[sheetId]['sheet'+count] = sheetFeed[count];\n\t\t\t\t\t\t},(error)=>{\n\t\t\t\t\t\t\tconsole.log(error);\n\t\t\t\t\t\t})\n\t\t\t\t\t})(x);\n\n\t\t\t\t}\n\t\t\t\t$timeout(()=>{Data.fb.$save();},10000);\n\t\t\t\t/*!Data.fb.sheetData[sheetId] ? Data.fb.sheetData[sheetId] = {} : null;*/\n\t\t\t});\n\t\t};\n\t\t// ApiBase.parseSheet('1cTKB4VTRk4-qdOtMkC12JMXdMIlgqTDwu8QruJg-ysc');\n\t\tApiBase.querify = () => {\n\t\t\tDate.prototype.getJulian = function () {\n\t\t\t\treturn Math.floor(this / 86400000 - this.getTimezoneOffset() / 1440 + 2440587.5);\n\t\t\t};\n\t\t\tvar cities = ['new york city'];\n\t\t\tvar venues = ['Webster Hall', 'PlayStation Theater', 'Gramercy Theatre'];\n\t\t\tvar bands = ['Daya', 'Tinashe', 'Nick Carter', 'Killswitch Engage'];\n\n\t\t\tvar today = new Date(); //set any date\n\t\t\tvar julian = today.getJulian();\n\t\t\tvar dateRange = 'daterange:' + (julian - 30) + '-' + julian;\n\t\t\tvar queries = {};\n\t\t\tfor (var x = 0; x < cities.length; x++) {\n\t\t\t\tfor (var y = 0; y < bands.length; y++) {\n\t\t\t\t\tqueries[bands[y]] = [];\n\t\t\t\t\tfor (var z = 0; z < venues.length; z++) {\n\t\t\t\t\t\t//var rawQuery = '&q=location:' + (locations[x] ? locations[x] : '') + ' ' + dateRange + ' %22' + (bands[z] ? bands[z] : '') + '%22 %22' + (venues[y] ? venues[y] : '') + '%22';\n\t\t\t\t\t\tvar rawQuery = 'location:\"' + (cities[x] ? cities[x] : '') + '\" ' + dateRange + ' \"' + (bands[y] ? bands[y] : '') + '\" \"' + (venues[z] ? venues[z] : '') + '\"';\n\t\t\t\t\t\tvar query = encodeURIComponent(rawQuery);\n\t\t\t\t\t\t// console.log(bands[y] && venues[z] && cities[x] ? query : 'something missing');\n\t\t\t\t\t\tbands[y] !== undefined ? ApiBase.query(query, bands[y], venues[z], cities[x]) : null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet time = Date.now();\n\t\t\tData.fb.$loaded().then(()=> {\n\t\t\t\t!Data.fb[State.user.uid].history ? Data.fb[State.user.uid].history = {} : null;\n\t\t\t\tData.fb[State.user.uid].history[time] = JSON.stringify(State.data);\n\t\t\t\tObject.keys(State.data).length > 0 ? Data.fb.$save() : null;\n\t\t\t});\n\t\t};\n\t\tApiBase.query = (query, band, venue, city) => {\n\n\t\t\tvar context = {data:{}};\n\t\t\t// context.data.key = 'AIzaSyAPQoU5zkFq3_sP3fB-v_V-mUhTspAU1bc';\n\t\t\t// context.data.key = 'AIzaSyAMQd1zbtPKZMTpH9Mqke2wnLlA1yBEoZU';\n\t\t\tcontext.data.key = 'AIzaSyD1c_QdWfmsIRw2HFo2LuJsQcMFGeu9BJw';\n\t\t\t// context.data.key = 'AIzaSyCoKhTHvXzcnYBdmwDijkVQ4BmoupX5qdc';\n\t\t\t// context.data.key = 'AIzaSyBL3VFlBRvdgmTeTQ_yr_E76RtNrtJn--k';\n\t\t\tcontext.data.cx = encodeURIComponent('009026615269609811859:gj09_ghhxea');\n\n\t\t\tvar baseUrl = 'https://www.googleapis.com/customsearch/v1';\n\t\t\tvar auth = '?key=' + context.data.key + '&cx=' + context.data.cx;\n\t\t\tvar authQuery = auth + '&q=' + query;\n\t\t\tvar req = {\n\t\t\t\tmethod: 'GET',\n\t\t\t\turl: baseUrl + authQuery,\n\t\t\t\theaders: {\n\t\t\t\t\t'Accept': 'application/json',\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t}\n\t\t\t\t// data: { query: bands[z] && venues[y] && locations[x] ? query : 'something missing' }\n\t\t\t};\n\t\t\t$http(req).then(function (success) {\n\t\t\t\t(State.data[band] || success.data.queries.request['0'].count === 0) ? null : State.data[band] = [];\n\t\t\t\tsuccess.data.queries.request['0'].count !== 0 ? State.data[band].push({\n\t\t\t\t\tdata: success.data,\n\t\t\t\t\tvenue: venue,\n\t\t\t\t\tcity: city\n\t\t\t\t}) : null;\n\t\t\t}, function (error) {\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\t\t};\n\t\tApiBase.login = (user, pass) => {\n\t\t\tconsole.info('Login ' + user);\n\t\t\tData.auth.$authWithPassword({\n\t\t\t\temail: user,\n\t\t\t\tpassword: pass\n\t\t\t}).then(function (auth) {\n\t\t\t\tconsole.log(\"Logged in as:\", auth.uid);\n\t\t\t\tData.fb.$loaded().then(()=>{!Data.fb[auth.uid] ? (Data.fb[auth.uid] = {created: Date.now()}, Data.fb.$save()) : null});\n\t\t\t\tState.user = auth;\n\t\t\t\tData.history = Data.fb[auth.uid];\n\t\t\t}).catch(function (error) {\n\t\t\t\tconsole.error(\"Authentication failed:\", error);\n\t\t\t});\n\t\t};\n\t\tApiBase.logout = () => {\n\t\t\tData.auth.$unauth();\n\t\t\tState.user = null;\n\t\t};\n\t\tApiBase.register = (user, pass) => {\n\t\t\tData.auth.$createUser({\n\t\t\t\temail: user,\n\t\t\t\tpassword: pass\n\t\t\t}).then(function (userData) {\n\t\t\t\tconsole.info(\"User \" + userData.uid + \" created successfully!\");\n\t\t\t\tData.fb[userData.uid] = {created: Date.now()};\n\t\t\t\tData.fb.$save();\n\t\t\t\treturn Data.auth.$authWithPassword({\n\t\t\t\t\temail: user,\n\t\t\t\t\tpassword: pass\n\t\t\t\t});\n\t\t\t}).then(function (auth) {\n\t\t\t\tconsole.info(\"Logged in as:\", auth.uid);\n\t\t\t\tState.user = auth;\n\t\t\t}).catch(function (error) {\n\t\t\t\tconsole.error(\"Error: \", error);\n\t\t\t});\n\t\t};\n\t\treturn ApiBase;\n\t}\n}());\n"],"sourceRoot":"/source/"}